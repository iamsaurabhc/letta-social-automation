{
    "$schema": "https://railway.app/railway.schema.json",
    "build": {
      "builder": "NIXPACKS",
      "buildCommand": "pnpm install && pnpm build",
      "nixpacksPlan": {
        "providers": ["node"],
        "phases": {
          "setup": {
            "nixPkgs": ["redis", "nodejs"]
          },
          "install": {
            "dependsOn": ["setup"],
            "cmds": [
              "npm install -g corepack",
              "corepack enable",
              "corepack prepare pnpm@8.15.4 --activate",
              "pnpm install"
            ]
          },
          "build": {
            "dependsOn": ["install"],
            "cmds": [
              "pnpm build:common",
              "pnpm --filter client build",
              "pnpm --filter server build"
            ]
          }
        }
      }
    },
    "deploy": {
      "startCommand": "pnpm start",
      "healthcheckPath": "/api/health",
      "healthcheckTimeout": 100,
      "restartPolicyType": "ON_FAILURE",
      "restartPolicyMaxRetries": 3,
      "numReplicas": 2
    }
  }